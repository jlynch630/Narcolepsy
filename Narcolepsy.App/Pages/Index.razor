@page "/"
@using Narcolepsy.Platform.Requests
@using Narcolepsy.App.Plugins
@using System.Diagnostics;
@using Narcolepsy.Platform.Serialization;
@inject PluginManager PluginManager;
@inject IJSRuntime JSRuntime;
@inject AssetManager AssetManager;

@if (Ready) {
    <RequestView />
} else {
    <Narcolepsy.Core.Components.Spinner />
}

@code {
    private bool Ready = false;

    protected override async Task OnInitializedAsync() {
        await PluginManager.InitializePluginsAsync();
        await base.OnInitializedAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        await base.OnAfterRenderAsync(firstRender);

        if (firstRender) {
            Stopwatch Stop = Stopwatch.StartNew();
            await this.AssetManager.LoadAllScriptsAsync(this.JSRuntime);
            await this.AssetManager.LoadAllStylesAsync(this.JSRuntime);
            Stop.Stop();
            System.Diagnostics.Debug.WriteLine(Stop.ElapsedMilliseconds);
            this.Ready = true;
            this.StateHasChanged();
        }

    }
}